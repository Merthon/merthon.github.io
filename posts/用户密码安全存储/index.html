<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>用户密码安全存储</title>
<meta name=description content="为什么不能明文存储密码？ 明文就是直接存储密码，这样有很大的风险，比如数据泄露，被人攻击等问题。所以为了避免这些问题，我们需要对密码进行加密存储。
非明文存储密码 哈希算法 密码哈希是一种将密码转换为固定长度字符串的技术，这个字符串与原始密码完全不同且不可逆。
盐值 盐值(salt)是指在进行密码哈希之前，向密码添加的 …"><meta name=keywords content='blog,hugo,'><meta property="og:url" content="https://merthon.github.io/posts/%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8%E5%AD%98%E5%82%A8/"><meta property="og:type" content="website"><meta property="og:title" content="用户密码安全存储"><meta property="og:description" content="为什么不能明文存储密码？ 明文就是直接存储密码，这样有很大的风险，比如数据泄露，被人攻击等问题。所以为了避免这些问题，我们需要对密码进行加密存储。
非明文存储密码 哈希算法 密码哈希是一种将密码转换为固定长度字符串的技术，这个字符串与原始密码完全不同且不可逆。
盐值 盐值(salt)是指在进行密码哈希之前，向密码添加的 …"><meta property="og:image" content="https://merthon.github.io/images/cat.webp"><meta property="og:image:secure_url" content="https://merthon.github.io/images/cat.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="用户密码安全存储"><meta name=twitter:description content="为什么不能明文存储密码？ 明文就是直接存储密码，这样有很大的风险，比如数据泄露，被人攻击等问题。所以为了避免这些问题，我们需要对密码进行加密存储。
非明文存储密码 哈希算法 密码哈希是一种将密码转换为固定长度字符串的技术，这个字符串与原始密码完全不同且不可逆。
盐值 盐值(salt)是指在进行密码哈希之前，向密码添加的 …"><meta property="twitter:domain" content="https://merthon.github.io/posts/%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8%E5%AD%98%E5%82%A8/"><meta property="twitter:url" content="https://merthon.github.io/posts/%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8%E5%AD%98%E5%82%A8/"><meta name=twitter:image content="https://merthon.github.io/images/cat.webp"><link rel=canonical href=https://merthon.github.io/posts/%E7%94%A8%E6%88%B7%E5%AF%86%E7%A0%81%E5%AE%89%E5%85%A8%E5%AD%98%E5%82%A8/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.275fedb6f364c8865658bae576d82b514ace973f6a13ed63503a85b20c697453.js integrity="sha256-J1/ttvNkyIZWWLrldtgrUUrOlz9qE+1jUDqFsgxpdFM="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://merthon.github.io/><img src=/images/cat.webp alt=cat></a></div><div class=nav-title><a class=nav-brand href=https://merthon.github.io/>Merthon</a></div><div class=nav-links><div class=nav-link><a href=https://merthon.github.io/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://merthon.github.io/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://merthon.github.io/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://merthon.github.io/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/Merthon aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://merthon.github.io/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://merthon.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://merthon.github.io/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://merthon.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/Merthon><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>用户密码安全存储</h1><small role=doc-subtitle></small><p class=post-date>June 24, 2024</p><ul class=post-tags><li class=post-tag><a href=https://merthon.github.io/tags/></a></li></ul></div><div class=post-content><h5 id=为什么不能明文存储密码>为什么不能明文存储密码？</h5><p>明文就是直接存储密码，这样有很大的风险，比如数据泄露，被人攻击等问题。所以为了避免这些问题，我们需要对密码进行加密存储。</p><h5 id=非明文存储密码>非明文存储密码</h5><h6 id=哈希算法>哈希算法</h6><p>密码哈希是一种将密码转换为固定长度字符串的技术，这个字符串与原始密码完全不同且不可逆。</p><h6 id=盐值>盐值</h6><p>盐值(salt)是指在进行密码哈希之前，向密码添加的一段随机数据。通常被添加到密码的开头或结尾，或者插入到密码的某个位置。其主要目的是确保即使两个用户拥有相同的密码，最终存储在数据库中的哈希值也会不同。</p><h6 id=代码实现>代码实现</h6><p>在Go中，我们可以使用<code>golang.org/x/crypto/bcrypt</code>库来处理密码的哈希和验证并且它内置了盐值的生成和管理。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span> 
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> ( <span style=color:#e6db74>&#34;fmt&#34;</span> 
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;log&#34;</span> 
</span></span><span style=display:flex><span>		<span style=color:#e6db74>&#34;golang.org/x/crypto/bcrypt&#34;</span> 
</span></span><span style=display:flex><span>) 
</span></span><span style=display:flex><span><span style=color:#75715e>// HashPassword 将密码进行哈希处理 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>HashPassword</span>(<span style=color:#a6e22e>password</span> <span style=color:#66d9ef>string</span>) (<span style=color:#66d9ef>string</span>, <span style=color:#66d9ef>error</span>){ 
</span></span><span style=display:flex><span>     <span style=color:#75715e>// 使用bcrypt生成密码的哈希值 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>hashedPassword</span>,<span style=color:#a6e22e>err</span><span style=color:#f92672>:=</span><span style=color:#a6e22e>bcrypt</span>.<span style=color:#a6e22e>GenerateFromPassword</span>([]byte(<span style=color:#a6e22e>password</span>),
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>bcrypt</span>.<span style=color:#a6e22e>DefaultCost</span>) 
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> { 
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#a6e22e>err</span> 
</span></span><span style=display:flex><span>     }
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>return</span> string(<span style=color:#a6e22e>hashedPassword</span>), <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span> }
</span></span><span style=display:flex><span><span style=color:#75715e>// CheckPasswordHash 验证输入的密码是否正确 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>CheckPasswordHash</span>(<span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>hashedPassword</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>bool</span> { 
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 使用bcrypt比较密码和哈希值 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>     <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bcrypt</span>.<span style=color:#a6e22e>CompareHashAndPassword</span>([]byte(<span style=color:#a6e22e>hashedPassword</span>), []byte(<span style=color:#a6e22e>password</span>))
</span></span><span style=display:flex><span>     <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> 
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() { 
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 假设这是用户输入的密码
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>password</span> <span style=color:#f92672>:=</span> <span style=color:#e6db74>&#34;cxcxcxpassword&#34;</span> 
</span></span><span style=display:flex><span>   <span style=color:#75715e>// 哈希密码 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>   <span style=color:#a6e22e>hashedPassword</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>HashPassword</span>(<span style=color:#a6e22e>password</span>)
</span></span><span style=display:flex><span>   <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> { 
</span></span><span style=display:flex><span>         <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;错误: %v&#34;</span>, <span style=color:#a6e22e>err</span>) 
</span></span><span style=display:flex><span>    } 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;原始密码: %s\n&#34;</span>, <span style=color:#a6e22e>password</span>) 
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;哈希后的密码: %s\n&#34;</span>, <span style=color:#a6e22e>hashedPassword</span>) 
</span></span><span style=display:flex><span>    <span style=color:#75715e>// 验证密码 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>isValid</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>CheckPasswordHash</span>(<span style=color:#a6e22e>password</span>, <span style=color:#a6e22e>hashedPassword</span>)
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;密码验证结果: %v\n&#34;</span>, <span style=color:#a6e22e>isValid</span>) 
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>过程：</p><ol><li>引入包：我们使用<code>golang.org/x/crypto/bcrypt</code>包来处理密码的哈希和验证。</li><li>HashPassword函数：该函数使用bcrypt库生成密码的哈希值。bcrypt在内部自动生成一个盐值，并将其添加到密码中进行哈希处理。生成的哈希值包含了盐值，因此在验证密码时不需要单独存储盐值。</li><li>CheckPasswordHash函数：该函数使用bcrypt库比较输入的密码和存储的哈希值。bcrypt库会从哈希值中提取盐值，并使用它来验证密码。</li></ol><h5 id=结尾>结尾</h5><p>这就是用户密码的非明文存储，密码哈希算法可以有效地保护用户密码的安全，有效防止密码泄露，保护用户数据安全。</p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><ul><li><ul><li></li></ul></li></ul></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2024 Merthon</span>
<span>Made with &#10084;&#65039; Hugo</span></footer></body></html>