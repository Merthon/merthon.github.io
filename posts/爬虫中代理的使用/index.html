<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D;--font-size:17.5px}</style><title>爬虫中代理的使用</title>
<meta name=description content="在爬虫中使用代理是为了应对一些网站的反爬虫机制，它能够帮助你隐藏爬虫的真实 IP 地址，避免被封禁。
代理的基本概念 代理服务器是一个中间服务器，它接受客户端的请求并代表客户端访问目标网站。通过代理，客户端的 IP 地址对目标服务器来说是代理服务器的 IP 地址，而不是爬虫的真实 IP。 常见的代理类型：
HTTP 代 …"><meta name=keywords content='blog,hugo,Python,爬虫,代理'><meta property="og:url" content="https://merthon.github.io/posts/%E7%88%AC%E8%99%AB%E4%B8%AD%E4%BB%A3%E7%90%86%E7%9A%84%E4%BD%BF%E7%94%A8/"><meta property="og:type" content="website"><meta property="og:title" content="爬虫中代理的使用"><meta property="og:description" content="在爬虫中使用代理是为了应对一些网站的反爬虫机制，它能够帮助你隐藏爬虫的真实 IP 地址，避免被封禁。
代理的基本概念 代理服务器是一个中间服务器，它接受客户端的请求并代表客户端访问目标网站。通过代理，客户端的 IP 地址对目标服务器来说是代理服务器的 IP 地址，而不是爬虫的真实 IP。 常见的代理类型：
HTTP 代 …"><meta property="og:image" content="https://merthon.github.io/images/cat.webp"><meta property="og:image:secure_url" content="https://merthon.github.io/images/cat.webp"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="爬虫中代理的使用"><meta name=twitter:description content="在爬虫中使用代理是为了应对一些网站的反爬虫机制，它能够帮助你隐藏爬虫的真实 IP 地址，避免被封禁。
代理的基本概念 代理服务器是一个中间服务器，它接受客户端的请求并代表客户端访问目标网站。通过代理，客户端的 IP 地址对目标服务器来说是代理服务器的 IP 地址，而不是爬虫的真实 IP。 常见的代理类型：
HTTP 代 …"><meta property="twitter:domain" content="https://merthon.github.io/posts/%E7%88%AC%E8%99%AB%E4%B8%AD%E4%BB%A3%E7%90%86%E7%9A%84%E4%BD%BF%E7%94%A8/"><meta property="twitter:url" content="https://merthon.github.io/posts/%E7%88%AC%E8%99%AB%E4%B8%AD%E4%BB%A3%E7%90%86%E7%9A%84%E4%BD%BF%E7%94%A8/"><meta name=twitter:image content="https://merthon.github.io/images/cat.webp"><link rel=canonical href=https://merthon.github.io/posts/%E7%88%AC%E8%99%AB%E4%B8%AD%E4%BB%A3%E7%90%86%E7%9A%84%E4%BD%BF%E7%94%A8/><link rel=stylesheet type=text/css href=/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/css/main.min.css><link id=dark-theme rel=stylesheet href=/css/dark.min.css><script src=/js/bundle.min.275fedb6f364c8865658bae576d82b514ace973f6a13ed63503a85b20c697453.js integrity="sha256-J1/ttvNkyIZWWLrldtgrUUrOlz9qE+1jUDqFsgxpdFM="></script></head><body><script>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://merthon.github.io/><img src=/images/cat.webp alt=cat></a></div><div class=nav-title><a class=nav-brand href=https://merthon.github.io/>Merthon</a></div><div class=nav-links><div class=nav-link><a href=https://merthon.github.io/ aria-label><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://merthon.github.io/posts/ aria-label><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://merthon.github.io/projects/ aria-label><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://merthon.github.io/tags/ aria-label><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/Merthon aria-label=github><span data-feather=github></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a aria-hidden=true role=switch><span class=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span class="sr-only hamburger-menu-toggle-screen-reader-target">menu</span>
<a aria-checked=false aria-labelledby=hamburger-menu-toggle id=hamburger-menu-toggle-target role=switch><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://merthon.github.io/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://merthon.github.io/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://merthon.github.io/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://merthon.github.io/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/Merthon><span data-feather=github></span></a></li><li class="nav-item dark-theme-toggle"><span class="sr-only dark-theme-toggle-screen-reader-target">theme</span>
<a role=switch><span class=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>爬虫中代理的使用</h1><small role=doc-subtitle></small><p class=post-date>January 12, 2025
| Updated January 12, 2025</p><ul class=post-tags><li class=post-tag><a href=https://merthon.github.io/tags/python>Python</a></li><li class=post-tag><a href=https://merthon.github.io/tags/%E7%88%AC%E8%99%AB>爬虫</a></li><li class=post-tag><a href=https://merthon.github.io/tags/%E4%BB%A3%E7%90%86>代理</a></li></ul></div><div class=post-content><p>在爬虫中使用代理是为了应对一些网站的反爬虫机制，它能够帮助你隐藏爬虫的真实 IP 地址，避免被封禁。</p><h1 id=代理的基本概念>代理的基本概念</h1><p>代理服务器是一个中间服务器，它接受客户端的请求并代表客户端访问目标网站。通过代理，客户端的 IP 地址对目标服务器来说是代理服务器的 IP 地址，而不是爬虫的真实 IP。
常见的代理类型：</p><ul><li><strong>HTTP 代理</strong>：适用于普通的 HTTP 请求。</li><li><strong>HTTPS 代理</strong>：适用于 HTTPS 请求，提供加密传输。</li><li><strong>SOCKS 代理</strong>：支持更多的协议类型，比 HTTP/HTTPS 代理更通用。</li><li><strong>透明代理</strong>：代理服务器不会修改请求或响应，目标服务器能看到真实的请求信息。</li><li><strong>匿名代理</strong>：代理服务器隐藏了客户端的 IP 地址，但目标服务器知道请求来自代理服务器。</li><li><strong>高匿代理</strong>：代理服务器不仅隐藏了客户端的 IP 地址，还不会暴露自己是代理服务器。</li></ul><h1 id=代理池>代理池</h1><p>为了提高爬虫的稳定性，通常会使用代理池，即预先准备一个代理 IP 列表，爬虫在运行时会从池中随机选取代理进行请求。这样，即便某个代理 IP 被封禁，爬虫仍然能够继续工作。
常见的代理池策略：</p><ul><li><strong>随机选择</strong>：每次请求时从代理池中随机选择一个代理。</li><li><strong>按频率限制使用</strong>：一些代理池会根据 IP 的使用频率进行调度，避免频繁使用同一个代理 IP。</li><li><strong>代理检查</strong>：定期检查代理是否可用，剔除掉失效的代理。</li></ul><h1 id=设置代理>设置代理</h1><ol><li>在 Python 爬虫中使用代理通常依赖于请求库（如 <code>requests</code>）或 Scrapy 框架。</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> requests
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>proxies <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;http&#39;</span>: <span style=color:#e6db74>&#39;http://username:password@proxy_ip:proxy_port&#39;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;https&#39;</span>: <span style=color:#e6db74>&#39;https://username:password@proxy_ip:proxy_port&#39;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>response <span style=color:#f92672>=</span> requests<span style=color:#f92672>.</span>get(<span style=color:#e6db74>&#39;http://example.com&#39;</span>, proxies<span style=color:#f92672>=</span>proxies)
</span></span><span style=display:flex><span>print(response<span style=color:#f92672>.</span>text)
</span></span></code></pre></div><ol start=2><li>使用 Scrapy 设置代理：
在 Scrapy 中，你可以通过中间件来设置代理。Scrapy 提供了 <code>HttpProxyMiddleware</code> 来处理代理设置。
<strong>启用代理中间件</strong>：
在 <code>settings.py</code> 中启用中间件：</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>DOWNLOADER_MIDDLEWARES <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#39;scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware&#39;</span>: <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>设置代理</strong>：
可以通过设置 <code>http_proxy</code> 来指定全局代理，或者在 <code>spider</code> 里为特定请求设置代理。</p><ul><li><strong>全局代理</strong>：
在 <code>settings.py</code> 中设置：<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span>HTTP_PROXY <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://proxy_ip:proxy_port&#39;</span>
</span></span></code></pre></div></li></ul><pre tabindex=0><code>- **为特定请求设置代理**：
在 Spider 中使用 `meta` 字段动态设置代理：
```python
def start_requests(self):
    url = &#39;http://example.com&#39;
    proxy = &#39;http://proxy_ip:proxy_port&#39;
    yield scrapy.Request(url, meta={&#39;proxy&#39;: proxy})
</code></pre><h1 id=使用代理的注意事项>使用代理的注意事项</h1><ul><li><strong>代理的质量</strong>：公开的免费代理通常不稳定，容易失效或被封禁。付费代理通常更稳定，速度更快，匿名性更好。</li><li><strong>代理的数量</strong>：使用多个代理可以减少单个代理被封禁的风险。</li><li><strong>反爬虫策略</strong>：有些网站不仅仅依靠 IP 进行防护，还会检测请求的频率、请求头等。适当的调整请求间隔和使用合适的 User-Agent 可以提高爬虫的成功率。</li><li><strong>代理验证</strong>：需要定期验证代理是否有效，如果代理池中的代理都不可用，爬虫可能无法正常工作。</li></ul><h1 id=常见的代理服务>常见的代理服务</h1><ul><li><strong>免费的代理</strong>：例如 <a href=https://www.free-proxy-list.net/>Free Proxy List</a>，这些代理的更新和质量通常较差，但适合简单的爬虫项目。</li><li><strong>付费的代理服务</strong>：例如 <a href=https://proxymesh.com/>ProxyMesh</a>、<a href=https://www.scraperapi.com/>ScraperAPI</a>、<a href=https://brightdata.com/>Bright Data</a>，这些服务提供高质量的代理和更多的功能，适合较为复杂的爬虫项目。</li></ul><h1 id=自动化管理代理池>自动化管理代理池</h1><p>你可以使用第三方库或自己实现代理池管理系统。例如，使用 <code>proxy_pool</code> 库来自动从多个代理源获取新的代理，并定期清理失效代理。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> proxy_pool <span style=color:#f92672>import</span> ProxyPool
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>proxy_pool <span style=color:#f92672>=</span> ProxyPool()
</span></span><span style=display:flex><span>proxy <span style=color:#f92672>=</span> proxy_pool<span style=color:#f92672>.</span>get_proxy()
</span></span></code></pre></div><p>爬虫中使用代理是保护自己免受封禁的一个重要手段，而如何选择、管理代理以及配合其他反爬措施（如调整请求头、控制请求速率等）是提高爬虫稳定性的关键。</p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="scrollToTop()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let backToTopButton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?backToTopButton.style.display="block":backToTopButton.style.display="none"}function scrollToTop(){window.scrollTo(0,0)}</script></div><aside class=post-toc><nav id=toc><nav id=TableOfContents><ul><li><a href=#代理的基本概念>代理的基本概念</a></li><li><a href=#代理池>代理池</a></li><li><a href=#设置代理>设置代理</a></li><li><a href=#使用代理的注意事项>使用代理的注意事项</a></li><li><a href=#常见的代理服务>常见的代理服务</a></li><li><a href=#自动化管理代理池>自动化管理代理池</a></li></ul></nav></nav></aside></main><footer class=footer><span>&copy; 2025 Merthon</span>
<span>Made with &#10084;&#65039; Hugo</span></footer></body></html>